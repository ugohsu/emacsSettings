* ugr-framenames, ugr-insert および frame.select の使い方

**
** 関数の目的
**

R を用いてなんらかの分析をおこなう場合、データの名前の管理が複雑なもの
となる。ugr-framenames (elisp 関数)、ugr-insert (elisp 関数)、および
frame.select (R 関数) は、emacs の機能を用いてデータの名前管理を容易に
するものである。

**
** 関数を用いる状況
**

本関数は、raw data の入った大きなデータフレームについて、変数を分析に
用いるもののみに限定し、かつ、データフレームの colnames を英数字に変更
する際に使用する。

**
** 使用例
**

tmp というデータフレームに、貸借対照表のデータが入っていたとする。
具体的には、

> str(tmp$C_bs)
'data.frame':	78527 obs. of  214 variables:
...
 $ 株式コード                                          : int  1301 ...
 $ 日経会社コード                                      : int  1 1 ...
 $ 日経業種集計値コード                                : logi  NA ...
 $ 決算期                                              : int  1984 ...
... 以下多数の変数

などとなっている。
いま、貸借対照表データのうち、日経会社コード、決算期、決算月数、総資産、
総負債、繰延税金資産、非連結子会社関連会社.受取手形.売掛金 (この科目は、
単に長く間違えやすそうな名前であることより選択した) のみからなる
temp_bs データフレームを作成するとする。

ここで、frame.select 関数を用いる。

>
temp_bs <- frame.select(tmp,
                        "日経会社コード",
                        "決算期",
                        "決算月数",
                        "資産合計",
                        "負債合計",
                        "繰延税金資産",
                        "非連結子会社関連会社.受取手形.売掛金")

のように、frame.select 関数の 1 番目の引数に対象となるデータフレーム
(今回は tmp) を入れ、2 番目以降の引数に必要なデータの列名を入れる。す
ると、

> str(temp_bs)
'data.frame':	78527 obs. of  7 variables:
 $ 日経会社コード                      : int  1 1 1  ...
 $ 決算期                              : int  198410 ...
 $ 決算月数                            : int  12 12  ...
 $ 資産合計                            : int  93094  ...
 $ 負債合計                            : int  91076  ...
 $ 繰延税金資産                        : int  NA NA  ...
 $ 非連結子会社関連会社.受取手形.売掛金: int  261 39 ...

のように、データが指定されたものに限定され、かつ、指定した順番に整列す
る。
あとは、データフレームの列名を、以下のように任意に変更すればよい。

colnames(temp_bs) <- c("FIRM","YAER","NYEAR","ASSET","LIABILITY",
                       "DTA","etc")
> str(temp_bs)
'data.frame':	78527 obs. of  7  ...
 $ FIRM     : int  1 1 1 1 1 1 1  ...
 $ YAER     : int  198410 198510  ...
 $ NYEAR    : int  12 12 12 12 5  ...
 $ ASSET    : int  93094 82267 82 ...
 $ LIABILITY: int  91076 74708 74 ...
 $ DTA      : int  NA NA NA NA NA ...
 $ etc      : int  261 398 467 56 ...

frame.select 関数を用いれば、データの名前の管理が上のようにすっきりす
る。
しかし、これを実践するためには、例えば上の例の「非連結子会社関連会社.受
取手形.売掛金」のような長い名前を間違えずに指定しなければならない。

この入力を補助するのが、ugr-framenames 関数および ugr-insert 関数であ
る。

使用方法としては、まず ugr-framenames 関数を使用する。

Alt-x ugr-framenames

とすると、ミニバッファに "data.frame or list: " とでるので、そこにデー
タフレームの名前 (今回は tmp) を挿入する。

その後、「temp_bs <- frame.select(tmp$C_bs,""」の " と " のあいだにカー
ソルをおき、

Ctrl-c i
または
Alt-x ugr-insert

とすると、ミニバッファに "frame names: " とでる。
ここで Ctrl-i とすると、tmp の列名を補完候補として、補完機能を使いなが
ら入力をおこなうことができる (たとえば、"非*売掛"と入力して C-i をおす
と、"非連結子会社関連会社.受取手形.売掛金" が一発ででる)。
